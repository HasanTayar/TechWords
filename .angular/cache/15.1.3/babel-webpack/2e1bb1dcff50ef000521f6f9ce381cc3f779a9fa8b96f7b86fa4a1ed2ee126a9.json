{"ast":null,"code":"import { Cart } from '../model/cart';\nimport { HttpHeaders } from '@angular/common/http';\nimport { of } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nexport class CartService {\n  constructor(router, http) {\n    this.router = router;\n    this.http = http;\n    this.cartUrl = 'http://localhost:3000/cart';\n    this.carts = [];\n  }\n  handleError(operation = 'operation', result) {\n    return error => {\n      console.error(error);\n      return of(result);\n    };\n  }\n  saveCartToDB(cart) {\n    const userEmail = localStorage.getItem('user');\n    localStorage.setItem(`cart_${userEmail}`, JSON.stringify(cart));\n    const httpOptions = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    };\n    return this.http.post(this.cartUrl, cart, httpOptions).pipe(catchError(this.handleError('saveCartToDB')));\n  }\n  getUserCart() {\n    const userEmail = localStorage.getItem('user');\n    if (!userEmail) {\n      // userEmail is not stored in local storage, so return an empty cart\n      return new Cart();\n    }\n    const cart = this.carts.find(c => c.user === userEmail);\n    if (!cart) {\n      const newCart = new Cart();\n      newCart.user = userEmail;\n      this.carts.push(newCart);\n      return newCart;\n    }\n    return cart;\n  }\n  clearCart() {\n    let cart = this.getUserCart();\n    cart = new Cart();\n    this.saveCartToDB(cart);\n  }\n  addToCart(product) {\n    const cart = this.getUserCart();\n    let existingProduct = cart.products.find(p => p.product.title === product.product.title);\n    if (existingProduct) {\n      existingProduct.qty++;\n      cart.totalPrice += product.product.price;\n    } else {\n      cart.products.push(product);\n      cart.totalPrice += product.product.price;\n    }\n    this.saveCartToDB(cart);\n  }\n  removeFromCart(product) {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products.splice(index, 1);\n      cart.totalPrice -= product.product.price * product.qty;\n    }\n    // Replace the local storage save with an HTTP request to the server\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n  quantityUp(product) {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty += 1;\n      cart.totalPrice += product.product.price;\n    }\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n  quantityDown(product) {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty -= 1;\n      cart.totalPrice -= product.product.price;\n    }\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n  payment() {\n    const cart = this.getUserCart();\n    cart.paid = true;\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n}\nCartService.ɵfac = function CartService_Factory(t) {\n  return new (t || CartService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.HttpClient));\n};\nCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CartService,\n  factory: CartService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Cart","HttpHeaders","of","CartService","constructor","router","http","handleError","operation","result","error","console","saveCartToDB","cart","userEmail","localStorage","getItem","setItem","JSON","stringify","httpOptions","headers","post","cartUrl","pipe","catchError","getUserCart","carts","find","c","user","newCart","push","clearCart","addToCart","product","existingProduct","products","p","title","qty","totalPrice","price","removeFromCart","index","indexOf","splice","put","id","subscribe","log","quantityUp","quantityDown","payment","paid","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\hasan\\MyWeb\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Cart, CartProduct } from '../model/cart';\nimport { Product } from '../model/product';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport \n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n  private cartUrl = 'http://localhost:3000/cart';\n  private carts: Cart[] = [];\n  \n  constructor(private router: Router, private http: HttpClient) { }\n  \n  private handleError<T>(operation = 'operation', result?: T) {\n    return (error: any): Observable<T> => {\n      console.error(error);\n      return of(result as T);\n    };\n  }\n\n  saveCartToDB(cart: Cart): Observable<Cart> {\n    const userEmail = localStorage.getItem('user');\n    localStorage.setItem(`cart_${userEmail}`, JSON.stringify(cart));\n\n    const httpOptions = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    };\n\n    return this.http.post<Cart>(this.cartUrl, cart, httpOptions).pipe(\n      catchError(this.handleError<Cart>('saveCartToDB'))\n    );\n  }\n \n\n  getUserCart(): Cart {\n    const userEmail = localStorage.getItem('user');\n    if (!userEmail) {\n      // userEmail is not stored in local storage, so return an empty cart\n      return new Cart();\n    }\n\n    const cart = this.carts.find(c => c.user === userEmail);\n    if (!cart) {\n      const newCart = new Cart();\n      newCart.user = userEmail;\n      this.carts.push(newCart);\n      return newCart;\n    }\n\n    return cart;\n  }\n  clearCart() {\n    let cart = this.getUserCart();\n    cart = new Cart();\n    this.saveCartToDB(cart);\n  }\n\n  addToCart(product: CartProduct): void {\n    const cart = this.getUserCart();\n    let existingProduct = cart.products.find(p => p.product.title === product.product.title);\n    if (existingProduct) {\n        existingProduct.qty++;\n        cart.totalPrice += product.product.price;\n    } else {\n        cart.products.push(product);\n        cart.totalPrice += product.product.price;\n    }\n\n    this.saveCartToDB(cart);\n  }\n\n\n  removeFromCart(product: CartProduct): void {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products.splice(index, 1);\n      cart.totalPrice -= product.product.price * product.qty;\n    }\n\n    // Replace the local storage save with an HTTP request to the server\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n\n  quantityUp(product: CartProduct): void {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty += 1;\n      cart.totalPrice += product.product.price;\n    }\n\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n  \n  quantityDown(product: CartProduct): void {\n    const cart = this.getUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty -= 1;\n      cart.totalPrice -= product.product.price;\n    }\n\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n  \n  payment() {\n    const cart = this.getUserCart();\n    cart.paid = true;\n\n    this.http.put(`${this.cartUrl}/${cart.id}`, cart).subscribe(() => {\n      console.log(`Cart updated successfully`);\n    });\n  }\n}\n  \n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}