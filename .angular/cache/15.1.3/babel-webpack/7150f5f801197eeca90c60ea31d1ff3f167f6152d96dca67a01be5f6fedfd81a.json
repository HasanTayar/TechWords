{"ast":null,"code":"import { Cart } from '../model/cart';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nexport class CartService {\n  removeFromCart(item) {\n    throw new Error('Method not implemented.');\n  }\n  constructor(router, http) {\n    this.router = router;\n    this.http = http;\n    this.carts = {};\n    this.baseUrl = \"http://localhost:3000/\";\n    this.headers = {\n      'content-type': 'application/json'\n    };\n    this.carts['anonymous'] = new Cart();\n  }\n  getCurrentUserCart() {\n    const userEmail = localStorage.getItem('user');\n    if (userEmail === null) {\n      return this.carts['anonymous'];\n    }\n    let cart = this.carts[userEmail];\n    if (!cart) {\n      cart = new Cart();\n      this.carts[userEmail] = cart;\n    }\n    return cart;\n  }\n  addProductToCart(product) {\n    const cart = this.getCurrentUserCart();\n    let existingProduct = cart.products.find(p => p.product.title === product.product.title);\n    if (existingProduct) {\n      existingProduct.qty++;\n      cart.totalPrice += product.product.price;\n    } else {\n      cart.products.push(product);\n      cart.totalPrice += product.product.price;\n    }\n  }\n  removeProductFromCart(product) {\n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products.splice(index, 1);\n      cart.totalPrice -= product.product.price * product.qty;\n    }\n  }\n  QuantityUp(product) {\n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty += 1;\n      cart.totalPrice += product.product.price;\n      product.product.price;\n    }\n  }\n  QuantityDown(product) {\n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty -= 1;\n      cart.totalPrice -= product.product.price;\n    }\n  }\n  getItems() {\n    const cart = this.getCurrentUserCart();\n    return cart.products;\n  }\n  gettotalprice() {\n    const cart = this.getCurrentUserCart();\n    return cart.totalPrice;\n  }\n  clearCart() {\n    const cart = this.getCurrentUserCart();\n    cart.products = [];\n    cart.totalPrice = 0;\n    return cart.products;\n  }\n  Payment() {\n    const cart = this.getCurrentUserCart();\n    const userEmail = localStorage.getItem('user');\n    if (cart.user === null) {\n      alert(\"you must be logged in to make the payment\");\n      this.router.navigateByUrl('/profile/login'); // navigate the user to the login page\n    } else if (userEmail) {\n      alert(\"Payment Successful\");\n      cart.paid = true;\n      this.saveCart().subscribe();\n      this.clearCart();\n    }\n  }\n  saveCart() {\n    const currentUserCart = this.getCurrentUserCart();\n    let body = JSON.stringify({\n      cart: currentUserCart\n    });\n    let b = JSON.stringify(this.carts['products']);\n    return this.http.post(this.baseUrl + 'cart', body, {\n      headers: this.headers\n    });\n  }\n}\nCartService.ɵfac = function CartService_Factory(t) {\n  return new (t || CartService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.HttpClient));\n};\nCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CartService,\n  factory: CartService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Cart","CartService","removeFromCart","item","Error","constructor","router","http","carts","getCurrentUserCart","userEmail","localStorage","getItem","cart","addProductToCart","product","existingProduct","products","find","p","title","qty","totalPrice","price","push","removeProductFromCart","index","indexOf","splice","QuantityUp","QuantityDown","getItems","gettotalprice","clearCart","Payment","user","alert","navigateByUrl","paid","saveCart","subscribe","currentUserCart","body","JSON","stringify","b","post","baseUrl","headers","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\hasan\\MyWeb\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Cart } from '../model/cart';\nimport { CartProduct } from '../model/cart';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n  removeFromCart(item: any) {\n    throw new Error('Method not implemented.');\n  }\n  private carts: { [userId: string]: Cart } = {};\n  baseUrl:string=\"http://localhost:3000/\";\n  headers={'content-type':'application/json'}\n  constructor(private router:Router,private http: HttpClient){\n    this.carts['anonymous']=new Cart();\n\n   }\n  \n   getCurrentUserCart(): Cart {\n    const userEmail = localStorage.getItem('user');\n    if(userEmail===null){\n      return this.carts['anonymous'];\n    }\n    let cart = this.carts[userEmail];\n    if (!cart) {\n      cart = new Cart;\n      this.carts[userEmail] = cart;\n      \n    }\n    return cart;\n  }\n\n\n\n\n\n  addProductToCart(product: CartProduct): void {\n    \n    const cart = this.getCurrentUserCart();\n    let existingProduct = cart.products.find(p => p.product.title === product.product.title);\n    if (existingProduct) {\n        existingProduct.qty++;\n        cart.totalPrice += product.product.price;\n    } else {\n        cart.products.push(product);\n        cart.totalPrice += product.product.price;\n    }\n  }\n\n\n  \n  removeProductFromCart(product: CartProduct): void {\n    \n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products.splice(index, 1);\n      cart.totalPrice -= product.product.price * product.qty;\n    }\n  }\n  \n  QuantityUp(product: CartProduct): void {\n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty += 1;\n      cart.totalPrice += product.product.price;\n      product.product.price \n    }\n  }\n  \n  QuantityDown(product: CartProduct): void {\n    const cart = this.getCurrentUserCart();\n    const index = cart.products.indexOf(product);\n    if (index > -1) {\n      cart.products[index].qty -= 1;\n      cart.totalPrice -= product.product.price;\n    }\n  }\n  \n  getItems(): CartProduct[] {\n    const cart = this.getCurrentUserCart();\n    return cart.products;\n  }\n  \n  gettotalprice(): number {\n    const cart = this.getCurrentUserCart();\n    return cart.totalPrice;\n  }\n  \n  clearCart(): CartProduct[] {\n    const cart = this.getCurrentUserCart();\n    cart.products = [];\n    cart.totalPrice = 0;\n    return cart.products;\n    \n  }\n \n  Payment(): void {\n    const cart = this.getCurrentUserCart();\n    const userEmail = localStorage.getItem('user');\n    if (cart.user === null){\n      alert(\"you must be logged in to make the payment\");\n      this.router.navigateByUrl('/profile/login'); // navigate the user to the login page\n    } else if(userEmail) {\n\n      alert(\"Payment Successful\");\n      cart.paid = true;\n      this.saveCart().subscribe(); \n      this.clearCart();\n    } \n  }\n  saveCart(): Observable<any> {\n    const currentUserCart = this.getCurrentUserCart();\n    let body = JSON.stringify({ cart: currentUserCart });   \n     let b = JSON.stringify(this.carts['products']);\n\n    return this.http.post(this.baseUrl+'cart',body,{\n      headers:this.headers\n    })\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}